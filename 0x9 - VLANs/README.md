# VLANs

<p align="center"><img width="600" src="https://github.com/wasny0ps/Network-Notes/blob/main/0x9%20-%20VLANs/src/VLANs.gif"></p>

VLANs (Virtual LANs) are logical grouping of devices in the same broadcast domain. VLANs are configured on switches by placing some interfaces into one broadcast domain and some interfaces into another. VLANs can be spread across multiple switches. Each VLAN is treated like its own subnet or broadcast domain, which means that frames broadcast onto the network are only switched between the ports within the same VLAN.

### Importance of VLAN

- **Control & Performance**: In switchers without VLANs, the incoming broadcast packet is sent to all ports of the switcher, regardless of whether the end devices receive it. This causes performance issues as it will cause unnecessary packet sending. **Unnecessary broadcast traffic is also blocked** if a network is partitioned using VLANs.
- **Security**: By using VLANs, groups that are not related to each other on a network are prevented from communicating with each other, and measures are taken against a possible external threat. **When the devices on the switcher are allocated to VLANs, a malicious user will not have a chance to connect to any end on the network and listen to the entire network and capture information**. The user will only be able to operate on the VLAN to which he will connect.
- **Scalability**: Broadcast groups are actually created on a network created by creating VLANs. It has the **flexibility to assign a user to the desired VLAN regardless of its physical location on the switcher**. Likewise, a **growing VLAN over time can be transferred to newly created VLANs**. This process is made possible by defining a new port on the switcher. When the same process is attempted without using VLAN support, the connection center for the newly created subnet (network) should be physically provided up to the router.

## Types of VLANs

 - **Data VLAN**: A data VLAN is a VLAN configured to carry non-specialized standard traffic. User-generated Internet traffic can be given as an example. In addition, a VLAN can carry simultaneous voice or video-based traffic. Another name for Data VLAN is User VLAN.
 - **Default VLAN**: All ports on the switcher are automatically included in the Default VLAN when the switcher is started. Having all ports of the switcher connected to the Default VLAN includes these ports in the same broadcast domain. This allows all devices connected to the switcher to communicate with each other. The Default VLAN for Cisco devices is "VLAN 1". VLAN 1 has the same features as other VLANs except that it cannot be renamed or deleted.
 - **Native VLAN**: Local VLAN is the VLAN assigned to the "Trunk" port. A trunk port supports untagged traffic as well as traffic generated by multiple VLANs (tagged traffic). The "Trunk" port forwards traffic not coming from any VLAN to the Local VLAN. Traffic generated by a device and not coming from any VLAN is forwarded over the switcher's VLAN configured as Local VLAN.
 - **Managament VLAN**: A management VLAN can be any VLAN configured to manage the switcher. If no dedicated VLAN is configured as the Management VLAN, "VLAN 1" serves as the Management VLAN. Once an IP address and subnet mask are assigned to the management VLAN, this switcher can be connected via HTTP, Telnet, SSH, or SNMP. Since "VLAN 1" is the Default VLAN on Cisco devices, it is preferable for security to separate the Management VLAN from the Default VLAN.


## VLAN Configration

Before VLAN configure in the switch, you must **connect devices to switch correct ports**. Here is my clear topology.

<p align="center"><img width="400" src="https://github.com/wasny0ps/Network-Notes/blob/main/0x9%20-%20VLANs/src/vlan.png"></p>


Then, define the vlans with vlan's ID and assign it's name. After that, turn on port status is "active" for each vlan's ports.

```
SW1(config)#vlan 10
SW1(config-vlan)#name Developers
SW1(config-vlan)#vlan 20
SW1(config-vlan)#name Pentesters
SW1(config-vlan)#vlan 30
SW1(config-vlan)#name Servers
SW1(config-vlan)#ex
SW1(config)#int range fa0/1-5
SW1(config-if-range)#switchport mode access
SW1(config-if-range)#switchport access vlan 10
SW1(config-vlan)#ex
SW1(config)#int range fa0/6-10
SW1(config-if-range)#switchport mode access
SW1(config-if-range)#switchport access vlan 20
SW1(config-vlan)#ex
SW1(config)#int range fa0/11-15
SW1(config-if-range)#switchport mode access
SW1(config-if-range)#switchport access vlan 30
```

And, you can see all VLANs like this command.

```
SW1(config-if-range)#do sh vlan brief

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/16, Fa0/17, Fa0/18, Fa0/19
                                                Fa0/20, Fa0/21, Fa0/22, Fa0/23
                                                Fa0/24, Gig0/1, Gig0/2
10   Developers                       active    Fa0/1, Fa0/2, Fa0/3, Fa0/4
                                                Fa0/5
20   Pentesters                       active    Fa0/6, Fa0/7, Fa0/8, Fa0/9
                                                Fa0/10
30   Servers                          active    Fa0/11, Fa0/12, Fa0/13, Fa0/14
                                                Fa0/15
1002 fddi-default                     active    
1003 token-ring-default               active    
1004 fddinet-default                  active    
1005 trnet-default                    active    
```
# VLAN Routing

VLAN is the logical grouping of devices in the same or different broadcast domains. By default, all the switch ports are in VLAN 1. As the single broadcast domain is divided into multiple broadcast domains, Routers or layer 3 switches are used for intercommunication between the different VLANs.The process of intercommunication of the different Vlans is known as Inter Vlan Routing (IVR). Inter-VLAN routing is the ability to route, or send, traffic between VLANs that are normally blocked by default. Switches and VLANs work at the Data Link Layer (Layer 2). **Traffic can't be routed between VLANs at Layer 2 based on MAC addresses**.

There are three types Inter Vlan Routing:

- Legacy Inter-VLAN Routing
- Router On Stick
- Layer3 Switch Inter-VLAN Routing

## Legacy Inter-VLAN Routing

<p align="center"><img width="500" src="https://github.com/wasny0ps/Network-Notes/blob/main/0x9%20-%20VLANs/src/legacy_inter_vlan.png"></p>


The legacy inter-VLAN routing connects different physical router interfaces to different physical ports on the switch. **The switch ports connected to the router must be placed in access mode**.

Each physical interface of the router is assigned to a different VLAN and the router interface then accepts the traffic from the VLAN related with the switch interface it is connected to. Then the router sends the traffic to other VLANs connected to the other interfaces. The figure below illustrates the legacy inter-VLAN routing process.

### Legacy Inter-VLAN Routing Configration

Here is my IPless legacy Inter VLAN topology. Let's assign IP to devices.

<p align="center"><img width="400" src="https://github.com/wasny0ps/Network-Notes/blob/main/0x9%20-%20VLANs/src/LIV_topology.png"></p>

In this step, create VLANs and configure it with correct topology informations. If you don't how to configure, please look at [here](https://github.com/wasny0ps/Network-Notes/edit/main/0x9%20-%20VLANs/README.md#vlan-configration). If you do it correctly, you must see kind of this result when you testing ping devices. You can access this topology [here](https://github.com/wasny0ps/Network-Notes/blob/main/0x9%20-%20VLANs/src/Legacy_Inter-VLAN_Routing.pkt).

<p align="center"><img width="250" src="https://github.com/wasny0ps/Network-Notes/blob/main/0x9%20-%20VLANs/src/ping.png"></p>


## Router On Stick

<p align="center"><img width="300" src="https://github.com/wasny0ps/Network-Notes/blob/main/0x9%20-%20VLANs/src/router_on_stick.png"></p>


The Routerâ€™s interface is divided into sub-interfaces, which acts as a default gateway to their respective VLANs.

### Router On Stick Configration

Here is my soft topology. **Let's assign IP address to only user devices not router!**

<p align="center"><img width="500" src="https://github.com/wasny0ps/Network-Notes/blob/main/0x9%20-%20VLANs/src/ROS_topology.png"></p>

Later, create VLANs and configure trunk protocol. Trunk helps to exchange VLAN information one and other. In another words, it send packets to router one way.

```
S0(config)#vlan 10
S0(config-vlan)#name DEVS
S0(config-vlan)#vlan 20
S0(config-vlan)#name CYBR
S0(config-vlan)#ex
S0(config)#int range fa0/1-10
S0(config-if-range)#switchport mode access
S0(config-if-range)#switchport access vlan 10
```

```
S1(config)#vlan 10
S1(config-vlan)#name DEVS
S1(config-vlan)#vlan 20
S1(config-vlan)#name CYBR
S1(config-vlan)#ex
S1(config)#int range fa0/11-20
S1(config-if-range)#switchport mode access
S1(config-if-range)#switchport access vlan 20
```
```
S0(config)#int range fa0/11
S0(config-if-range)#switchport mode trunk
S0(config-if-range)#ex
S0(config)#int range fastEthernet 0/21
S0(config-if-range)#switchport mode trunk 
```
```
S1(config)#int range fa0/10
S1(config-if-range)#switchport mode trunk 
```

Finally, configure the router. First, enter the interface which is connected to switch and **just shutdown and exit**. Secondly, **give sub interface's IP address and subnetmask with VLAN ID after execute** `encapsulation dot1Q vlan ID` **command**.

```
R1(config)#int gi0/0/1
R1(config-if)#no shut
R1(config-if)#ex
R1(config)#int range gi0/0/1.10
R1(config-if-range)#encapsulation dot1Q 10
R1(config-if-range)#ip add 192.168.10.1 255.255.255.0
R1(config-if-range)#no shut
R1(config-if-range)#ex
R1(config)#int range gi0/0/1.20
R1(config-if-range)#encapsulation dot1Q 20
R1(config-if-range)#ip add 192.168.20.1 255.255.255.0
R1(config-if-range)#no shut
```

You can access this topology [here](https://github.com/wasny0ps/Network-Notes/blob/main/0x9%20-%20VLANs/src/Router_On_Stick.pkt).

## Layer3 Switch Inter-VLAN Routing

<p align="center"><img width="500" src="https://github.com/wasny0ps/Network-Notes/blob/main/0x9%20-%20VLANs/src/Layer%203%20switch_inter_vlan.gif"></p>


A switch is a device that typically operates at layer 2 of the OSI model. It inspects frames and switches them between interfaces based on MAC addresses found in the Ethernet header. This type of device is referred to as just a switch or a Layer 2 switch. It does not look deeper than the Ethernet header and does not make any decisions based on information in the IP header. Routers on the other hand strip the Ethernet header of frames and look at the packet in the frame's payload. They make routing decisions based on the IP addresses found in the Layer 3 header and place a new Ethernet header before switching the frame out another interface. 

**A multilayer switch** can perform both functions explained above at incredibly fast speeds. They can switch **frames as a regular switch and can perform IP routing as a router**. So therefore they can perform functions at layer 2 of the OSI model as well as at layer 3. That is why they are called **Multilayer Switches** or **Layer 3 switches**.

### Layer3 Switch Inter-VLAN Routing Configration

Here my starting topology. Let's assign IP address to user devices and do VLAN configration.

<p align="center"><img  src="https://github.com/wasny0ps/Network-Notes/blob/main/0x9%20-%20VLANs/src/MLSW_inter_vlan_topology.png"></p>

After completed previous step, configure trunk protocol with switch-switch and switch-router.

```
S0(config)#interface fastEthernet 0/20
S0(config-if)#switchport mode trunk 
```
```
S1(config)#interface fastEthernet 0/20
S1(config-if)#switchport mode trunk
S1(config-if)#ex
S1(config)#interface fastEthernet 0/21
S1(config-if)#switchport mode trunk
S1(config-if)#ex
S1(config)#interface fastEthernet 0/24
S1(config-if)#switchport mode trunk
```
```
S2(config)#interface fastEthernet 0/21
S2(config-if)#switchport mode trunk 
```

The last thing to do is execute `ip routing` command in the multi layer switch for work on layer 3. After that create same VLAN and assign IP address into the VLAN's interface.

```
MLSW(config)#ip routing
MLSW(config)#vlan 10
MLSW(config-vlan)#name DEVS
MLSW(config-vlan)#vlan 20
MLSW(config-vlan)#name CYBR
MLSW(config-vlan)#vlan 30
MLSW(config-vlan)#name LMRS
MLSW(config-vlan)#ex
MLSW(config)#int vlan 10
MLSW(config-if)#ip add 192.168.10.1 255.255.255.0
MLSW(config-if)#no shut
MLSW(config-if)#ex
MLSW(config)#int vlan 20
MLSW(config-if)#ip add 192.168.20.1 255.255.255.0
MLSW(config-if)#no shut
MLSW(config-if)#ex
MLSW(config)#int vlan 30
MLSW(config-if)#ip add 192.168.30.1 255.255.255.0
MLSW(config-if)#no shut
```

You can access this topology [here](https://github.com/wasny0ps/Network-Notes/blob/main/0x9%20-%20VLANs/src/MLSW_Inter-Vlan.pkt).

## Spanning Tree Protocol (STP)

STP is a protocol used to **prevent loops that may occur between switchers in a network**. **STP selects a root bridge among switchers in a network where it is active and blocks ports that could cause looping between switchers**. In this way, STP eliminates the risk of physical loops in networks consisting of switchers. However, if sufficient attention is not paid to STP security, STP attacks may occur and endless loops may occur.
The most known STP threats are; seizing the root bridge, changing the STP active topologies, changing the STP timers, constantly creating Topology Change Notification.

[More about STP](https://content.cisco.com/chapter.sjs?uri=/searchable/chapter/content/en/us/td/docs/routers/nfvis/switch_command/b-nfvis-switch-command-reference/spanning_tree_commands.html.xml).

### Portfast

To enable the PortFast mode, use the spanning-tree portfast command in interface switch configuration mode. In PortFast mode, the interface is immediately put into the forwarding state upon linkup, without waiting for the standard forward time delay. To disable the PortFast mode, use the no form of this command.

```
SW(config-switch)# interface gigabitEthernet 1/1
SW(config-switch-if)# spanning-tree portfast enable
```

### BPDU Protection

Hackers can cause loops by connecting their switchers to ports that have portfast turned on. Because in ports where portfast is open, a while loop may occur as the port immediately switches to the transmission state.

To prevent this situation, a feature called "BPDU Guard" has been developed. BPDU protection, when BPDU is received from ports where portfast is open, it performs the function of closing that port. Thus,** when the malicious person connects his switcher to the network, the port he connects to is automatically closed**.

- Based on port
```
SW(config-switch)# interface gigabitEthernet 1/1
SW(config-switch-if)# spanning-tree bpduguard enable 
```

- All ports includes 

```
SW(config)# spanning-tree portfast bpduguard default
```

## Dynamic Trunking Protocol (DTP)

Dynamic Trunking Protocol is a network protocol that runs at the "Data Link" layer, the second of the OSI layers developed by Cisco. DTP, briefly, is a protocol that works between Cisco Switches (switchers) and allows two switchers to **make the port they are connected to a Trunk port with the DTP message they share between them**. Through the Dynamic Trunk Protocol, "trunking" between ports is done automatically. **There are 4 kinds of modes that can be applied to realize the Dynamic Trunk Protocol: "Switchports" can be Auto (automatic) or Desirable (desired) in terms of DTP**. Except for automatic and desired modes, "switchports" can be determined as static, access or trunk by the administrator. Dynamic Desirable (Dynamic Desirable) and Dynamic Auto (Dynamic auto) determine whether the port can automatically "trunk" and this determination is related to sending DTP packets along the line. These modes tend to be "trunk". The way these ports, which are desirable as standard, work when auto or desirable can be understood from the table below.

<p align="center"><img width="500" src="https://github.com/wasny0ps/Network-Notes/blob/main/0x9%20-%20VLANs/src/DTP.png"></p>



## VLAN Trunking Protocol (VTP)



## Etherchannel




 
